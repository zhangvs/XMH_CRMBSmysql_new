var mains = new Array(); var h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; var daycount = 0; var axisData = new Array(); var saleData = new Array(); var backData = new Array(); var saleBackData = new Array(); var saleDataSums = new Array(); var backDataSums = new Array(); var saleBackDataSums = new Array(); var monthSaleDataSum = 0; var monthBackDataSum = 0; var monthSaleBackDataSum = 0; var user_id; var u_company; var user_name; var user_ids = new Array(); var u_companys = new Array(); var user_names = new Array(); var monthCount; var month_counts = new Array(); var month_frequencys = new Array(); var month_countsSum = 0; var month_frequencysSum = 0; var user_count = 0; var name; var admin_user_name; function getDateCount(syear, smonth) { daycount = 0; var day = new Date(syear, smonth, 0); daycount = day.getDate() } function showAxisData() { axisData = []; for (var j = 0; j < daycount; j++) { axisData[j] = j + 1 + "日" } } function getMonthSaleBackData(GridData, smonth) { $("#form1").html(""); mains = []; user_ids = []; u_companys = []; user_names = []; saleData = []; backData = []; saleBackData = []; saleBackDataSums = []; saleDataSums = []; backDataSums = []; monthSaleDataSum = 0; monthBackDataSum = 0; monthSaleBackDataSum = 0; month_counts = []; month_frequencys = []; month_countsSum = 0; month_frequencysSum = 0; for (var j = 0; j < GridData.Rows.length; j++) { if (j == 0) { admin_user_name = GridData.Rows[j].admin_user_name; name = GridData.Rows[j].name; user_count = GridData.Rows[j].user_count } user_id = GridData.Rows[j].user_id; u_company = GridData.Rows[j].u_company; user_name = GridData.Rows[j].user_name; monthCount = GridData.Rows[j].monthCount; if ($.inArray(user_id, user_ids) < 0) { var seriess_id = user_ids.push(user_id) - 1; u_companys.push(u_company); user_names.push(user_name); if (monthCount == null) { month_counts.push(0); month_frequencys.push(0) } else { month_counts.push(monthCount); month_frequencys.push(parseFloat((30 / monthCount).toFixed())) } $("#form1").append("<a id='a_main" + seriess_id + "' href='#main" + seriess_id + "'> </a><div id='main" + seriess_id + "' ></div>"); saleBackData[seriess_id] = new Array(); saleData[seriess_id] = new Array(); backData[seriess_id] = new Array(); saleBackDataSums[seriess_id] = parseFloat(GridData.Rows[j].realmoney1.toFixed()); saleDataSums[seriess_id] = parseFloat(GridData.Rows[j].salemoney1.toFixed()); backDataSums[seriess_id] = parseFloat(GridData.Rows[j].backmoney1.toFixed()); monthSaleBackDataSum += saleBackDataSums[seriess_id]; monthSaleDataSum += saleDataSums[seriess_id]; monthBackDataSum += backDataSums[seriess_id]; month_countsSum += monthCount; for (var i = 0; i < daycount; i++) { saleData[seriess_id][i] = 0; backData[seriess_id][i] = 0; saleBackData[seriess_id][i] = 0 } } var orderDate = parseInt(GridData.Rows[j].orderdate) - 1; saleBackData[seriess_id][orderDate] = parseFloat(GridData.Rows[j].realmoney.toFixed()); saleData[seriess_id][orderDate] = parseFloat(GridData.Rows[j].salemoney.toFixed()); backData[seriess_id][orderDate] = parseFloat(GridData.Rows[j].backmoney.toFixed()) } if (month_countsSum == 0) { month_frequencysSum = 0 } else { month_frequencysSum = parseFloat((25 / month_countsSum * 8).toFixed(1)) } if (!Array.prototype.forEach) { Array.prototype.forEach = function forEach(callback, thisArg) { var T, k; if (this == null) { throw new TypeError("this is null or not defined") } var O = Object(this); var len = O.length >>> 0; if (typeof callback !== "function") { throw new TypeError(callback + " is not a function") } if (arguments.length > 1) { T = thisArg } k = 0; while (k < len) { var kValue; if (k in O) { kValue = O[k]; callback.call(T, kValue, k, O) } k++ } } } saleBackData.forEach(function DrawEChart(v, e) { $("#main" + e).css("height", 300); var option = { title: { text: u_companys[e] + '_' + $("#smonth").val() + '月(可点击查看客户销售品牌详情)', link: '/DMS/ReportForm/dms_customer_brand.aspx?admin_user_name=' + admin_user_name + '&user_id=' + user_ids[e] + '&syear=' + $("#syear").val() + '&smonth=' + $("#smonth").val() + '&month_count=' + month_counts[e] + '&month_frequency=' + month_frequencys[e] + '&rnd=' + Math.random(), subtext: '\n\n月销量：' + saleDataSums[e] + '\n月退货：' + backDataSums[e] + '\n月实际：' + saleBackDataSums[e] + '\n\n致电：' + user_names[e] + '\n\n月拿货次数：' + month_counts[e] + ' 次' + '\n月拿货频率：' + month_frequencys[e] + ' 天/次' }, grid: { x: 180, }, tooltip: { trigger: 'axis', showDelay: 0, formatter: function (params, ticket, callback) { var res = params[0].name; for (var i = 0, l = params.length; i < l; i++) { res += '<br/>' + params[i].seriesName + ' : ' + params[i].value } return res } }, legend: { data: ['日销售额', '日退货额', '日实际销售额'], selected: { '日销售额': false, '日退货额': false, '日实际销售额': true } }, toolbox: { show: true, orient: 'vertical', feature: { mark: { show: true }, dataView: { show: true, readOnly: false, optionToContent: function (opt) { $("#main" + e).css("height", 680); var series = opt.series; var table = '<table class="dataView" style="width:100%;text-align:center;border:1px solid"><tbody><tr>' + '<td>日期</td>'; for (var i = 0, l = series.length; i < l; i++) { table += '<td>' + series[i].name + '</td>' }; table += '</tr>'; for (var m = 0, g = axisData.length; m < g; m++) { table += '<tr><td>' + axisData[m] + '</td>'; for (var n = 0, l = series.length; n < l; n++) { var val = series[n].data[m]; if (n == 4 || n == 7) val += '%'; table += '<td>' + val + '</td>' } table += '</tr>' }; table += '</tbody></table>'; return table } }, magicType: { show: true, type: ['line', 'bar'] }, restore: { show: true }, saveAsImage: { show: true } } }, calculable: true, xAxis: [{ type: 'category', data: axisData }], yAxis: [{ type: 'value', scale: true, axisLabel: { formatter: function (v) { return v } }, splitArea: { show: true } }], series: [{ name: '日销售额', stack: '日期', type: 'bar', itemStyle: { normal: { label: { show: true, position: 'top' } } }, data: saleData[e] }, { name: '日退货额', stack: '日期', type: 'bar', itemStyle: { normal: { label: { show: true, position: 'bottom' } } }, data: backData[e] }, { name: '日实际销售额', stack: '日期', type: 'bar', itemStyle: { normal: { label: { show: true, position: 'top' } } }, data: saleBackData[e], }] }; var myChart = echarts.init(document.getElementById('main' + e), 'macarons'); myChart.setOption(option); mains.push(myChart) }) } $(window).resize(function () { mains.forEach(function echartsHight(v, e) { v.resize() }) }); function DrawEChartCustomer() { $("#main0").before("<div id='main' ></div>"); $("#main").css("height", 450); var option = { title: { text: admin_user_name + '_' + name + '_' + $("#smonth").val() + '月份客户销售明细', subtext: '\n\n客服' + '\n月销售和：' + monthSaleDataSum + '\n月退货和：' + monthBackDataSum + '\n月实际销售和：' + monthSaleBackDataSum + '\n\n月客户数：' + saleBackData.length + '\n分配数：' + user_count + '\n月成交率：' + parseFloat((saleBackData.length / user_count * 100).toFixed()) + '%' + '\n\n月成交次数：' + month_countsSum + ' 次' + '\n月成交频率：' + month_frequencysSum + ' 小时/次' }, visualMap: { top: 20, right: 40, min: 0, max: 20000, pieces: [{ min: 20000 }, { min: 10000, max: 20000 }, { min: 5000, max: 10000 }, { min: 1000, max: 5000, }, { max: 1000 }], color: ['#d94e5d', '#eac736', '#50a3ba'], }, grid: { x: 180, y2: 200 }, tooltip: { trigger: 'axis', showDelay: 0, formatter: function (params, ticket, callback) { var res = '可点击定位客户<br/>' + params[0].name; for (var i = 0, l = params.length; i < l; i++) { res += '<br/>' + params[i].seriesName + ' : ' + params[i].value } return res } }, legend: { data: ['月拿货次数', '月拿货频率(天/次)', '月销售额', '月退货额', '月实际销售额'], selected: { '月销售额': false, '月退货额': false, '月实际销售额': true, '月拿货次数': false, '月拿货频率(天/次)': false } }, toolbox: { show: true, orient: 'vertical', feature: { mark: { show: true }, dataView: { show: true, readOnly: false, optionToContent: function (opt) { var hh = (u_companys.length + 1) * 22; if (hh < 400) { hh = 400 } $("#main").css("height", hh); var series = opt.series; var table = '<table class="dataView" style="width:100%;text-align:center;border:1px solid"><tbody><tr><td>序号</td><td>客户</td><td>电话</td>'; for (var i = 0, l = series.length; i < l; i++) { table += '<td>' + series[i].name + '</td>' }; table += '</tr>'; for (var m = 0, g = u_companys.length; m < g; m++) { var no = m + 1; table += '<tr><td>' + no + '</td><td>' + u_companys[m] + '</td><td>' + user_names[m] + '</td>'; for (var n = 0, l = series.length; n < l; n++) { var val = series[n].data[m]; table += '<td>' + val + '</td>' } table += '</tr>' }; table += '</tbody></table>'; return table }, }, magicType: { show: true, type: ['line', 'bar'] }, restore: { show: true }, saveAsImage: { show: true } } }, calculable: true, xAxis: [{ type: 'category', axisLabel: { interval: 0, rotate: 45, textStyle: { fontWeight: "bolder", color: "#000000" } }, data: u_companys }], yAxis: [{ type: 'value', scale: true, axisLabel: { formatter: function (v) { return v } }, splitArea: { show: true } }], series: [{ name: '月销售额', stack: '月份', type: 'bar', itemStyle: { normal: { label: { show: true, position: 'top' } } }, data: saleDataSums }, { name: '月退货额', stack: '月份', type: 'bar', itemStyle: { normal: { label: { show: true, position: 'top' } } }, data: backDataSums }, { name: '月实际销售额', type: 'bar', itemStyle: { normal: { label: { show: true, position: 'top' } } }, data: saleBackDataSums }, { name: '月拿货次数', type: 'bar', itemStyle: { normal: { label: { show: true, position: 'top' } } }, data: month_counts }, { name: '月拿货频率(天/次)', type: 'bar', itemStyle: { normal: { label: { show: true, position: 'top' } } }, data: month_frequencys }] }; var myChartDep = echarts.init(document.getElementById('main'), 'macarons'); myChartDep.setOption(option); window.onresize = myChartDep.resize; myChartDep.on('click', function (params) { document.getElementById("a_main" + params.dataIndex).click() }) }