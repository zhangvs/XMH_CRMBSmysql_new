var app = {}; var data = []; var nowFeat = 0.00; var now = new Date(); var nowtime = Math.floor(now.getTime() / 1000); var pretime = Math.floor(nowtime - 3600); var day = new Date(now.format("yyyy-MM-dd")); var daytime = Math.floor((day.getTime() / 1000) - 28800); $(function () { var select = $("#hours"); var miniTime = Math.floor(day.getTime() / 1000); for (var sTime = nowtime - 3600; sTime >= miniTime; sTime = sTime - 3600) { var newdate = new Date(sTime * 1000); select.append("<option value='" + sTime + "'>" + newdate.getHours() + "</option>") } setUpHours() });function setUpHours(){app={};data=[];nowFeat=0.00;now=new Date();nowtime=Math.floor(now.getTime()/1000);pretime=Math.floor(nowtime-3600);day=new Date(now.format("yyyy-MM-dd"));daytime=Math.floor((day.getTime()/1000)-28800);pretime=Number($("#hours").val());getCurData()}function test(){option={title:{text:now.format("yyyy-MM-dd")+'业绩走势图'},toolbox:{show:true,feature:{mark:{show:true},saveAsImage:{show:true}}},tooltip:{trigger:'axis',formatter:function(params){params=params[0];var date=new Date(params.name);return date.getHours()+':'+(date.getMinutes())+':'+date.getSeconds()+' ￥ '+toMoney(params.value[1])},axisPointer:{animation:false}},xAxis:{type:'time',splitNumber:12,splitLine:{show:false}},yAxis:{type:'value',boundaryGap:[0,'100%'],splitLine:{show:false}},series:[{name:'模拟数据',type:'line',showSymbol:false,hoverAnimation:false,areaStyle:{normal:{}},markLine:{data:[{type:'max',name:'最大值',symbol:'emptyCircle',itemStyle:{normal:{color:'#dc143c'}}},{type:'min',name:'最小值',symbol:'emptyCircle',itemStyle:{normal:{color:'#1e90ff'}}},]},data:data}]};app.timeTicket=setInterval(function(){$.ajax({type:"POST",url:"../../DMS/DMS_TimeAxis.ashx",data:{Action:"getWillData",nowtime:nowtime},dataType:'json',success:function(responseText){for(var i=0;i<1;i++){data.shift();data.push({name:(nowtime+=10)*1000,value:[nowtime*1000,nowFeat+=responseText.feat]})}myChart.setOption({series:[{data:data}]})},error:function(){}})},10000);var myChart=echarts.init(document.getElementById('graph1'),'macarons');myChart.setOption(option)}function getCurData(){$.ajax({type:"POST",url:"../../DMS/DMS_TimeAxis.ashx",data:{Action:"getCurData",nowtime:nowtime,pretime:pretime,daytime:daytime},dataType:'json',success:function(responseText){var result=eval(responseText);$(result).each(function(i,val){if(val.Rows[i].type=='1'){nowFeat=val.Rows[i].feat}});for(var time=pretime;time<=nowtime;time+=10){for(j=0;j<result.Rows.length;j++){if(result.Rows[j].type=='2'&&result.Rows[j].erp_time<=time&&result.Rows[j].erp_time>(time-10)){nowFeat+=result.Rows[j].feat}}data.push({name:time*1000,value:[time*1000,nowFeat]})}test()},error:function(){}})}